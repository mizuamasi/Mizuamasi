<!-- index.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>シェーダーエディター - ログイン</title>
  <link rel="stylesheet" href="styles.css">
  
  <!-- Font Awesomeの読み込み -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <!-- 認証画面 -->
  <div id="auth-container">
    <h1>ログイン / 新規登録</h1>
    <input type="text" id="nickname" placeholder="ニックネーム">
    <input type="password" id="password" placeholder="パスワード">
    <div id="auth-buttons">
      <button id="register-btn" title="新規登録"><i class="fas fa-user-plus"></i></button>
      <button id="login-btn" title="ログイン"><i class="fas fa-sign-in-alt"></i></button>
    </div>
    <button id="continue-without-tracking-btn" title="トラッキングなしで続行"><i class="fas fa-eye-slash"></i></button>
  </div>
  
  <!-- スピナー要素（非表示時） -->
  <div id="auth-spinner" class="spinner hidden"></div>

  <!-- スクリプト -->
  <script>
    const BACKEND_URL = 'https://script.google.com/macros/s/YOUR_GAS_DEPLOYMENT_ID/exec';

    document.getElementById('register-btn').addEventListener('click', () => {
      const nickname = document.getElementById('nickname').value.trim();
      const password = document.getElementById('password').value.trim();

      if (!nickname || !password) {
        alert('ニックネームとパスワードを入力してください。');
        return;
      }

      const data = new URLSearchParams();
      data.append('action', 'register');
      data.append('nickname', nickname);
      data.append('password', password);

      fetch(BACKEND_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: data.toString()
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          alert(result.message);
          localStorage.setItem('session', JSON.stringify({ isLoggedIn: true, nickname }));
          window.location.href = 'editor.html';
        } else {
          alert(result.message);
        }
      })
      .catch(error => {
        console.error('登録エラー:', error);
        alert('登録中にエラーが発生しました。');
      });
    });

    document.getElementById('login-btn').addEventListener('click', () => {
      const nickname = document.getElementById('nickname').value.trim();
      const password = document.getElementById('password').value.trim();

      if (!nickname || !password) {
        alert('ニックネームとパスワードを入力してください。');
        return;
      }

      const data = new URLSearchParams();
      data.append('action', 'login');
      data.append('nickname', nickname);
      data.append('password', password);

      fetch(BACKEND_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: data.toString()
      })
      .then(response => response.json())
      .then(result => {
        if (result.success) {
          alert(result.message);
          localStorage.setItem('session', JSON.stringify({ isLoggedIn: true, nickname }));
          window.location.href = 'editor.html';
        } else {
          alert(result.message);
        }
      })
      .catch(error => {
        console.error('ログインエラー:', error);
        alert('ログイン中にエラーが発生しました。');
      });
    });

    document.getElementById('continue-without-tracking-btn').addEventListener('click', () => {
      localStorage.setItem('session', JSON.stringify({ isLoggedIn: false }));
      window.location.href = 'editor.html';
    });
  </script>
</body>
</html>
